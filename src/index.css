/* Шрифты: системный стек, без Google Fonts (нет блокировки на momrecipesai.netlify.app) */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Динамическая высота viewport для мобилки/PWA (обновляется в JS при resize/orientationchange). */
    --app-height: 100vh;
    /* Единая оливковая палитра */
    --color-primary: #6E7F3B;
    --color-primary-light: #F3F6EC;
    --color-primary-border: #DCE3C7;
    --color-bg-main: #FAFAF7;
    --color-text-main: #2F2F2F;

    /* Фон приложения #FAFAF7 */
    --background: 60 20% 97.5%;
    --foreground: 0 0% 18%;

    --card: 0 0% 100%;
    --card-foreground: 0 0% 18%;

    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 18%;

    /* Primary = оливковый #6E7F3B */
    --primary: 75 37% 36%;
    --primary-foreground: 0 0% 100%;

    /* Warm peach - secondary */
    --secondary: 25 80% 85%;
    --secondary-foreground: 25 60% 30%;

    /* Lavender - accent */
    --accent: 270 50% 88%;
    --accent-foreground: 270 40% 30%;

    --muted: 40 20% 94%;
    --muted-foreground: 0 0% 40%;

    --destructive: 0 70% 65%;
    --destructive-foreground: 0 0% 100%;

    --border: 40 20% 88%;
    --input: 40 20% 88%;
    --ring: 75 37% 36%;

    --radius: 1rem;

    /* Layout: единый источник истины для safe-area и отступов (см. контракт в MobileLayout.tsx)
     * TopBar: контентная высота 32px; header-offset = safe-area + 32px. */
    --header-content-height: 2rem; /* 32px */
    --header-row-py: 0px;
    --layout-header-gap: 0px;
    --layout-header-offset: calc(env(safe-area-inset-top, 0px) + var(--header-content-height) + var(--header-row-py) * 2 + var(--layout-header-gap));
    --layout-nav-height: 4rem;
    --layout-main-bottom: calc(var(--layout-nav-height) + env(safe-area-inset-bottom, 0px) + 0.5rem);

    /* Совместимость: mint → primary-light (оливковая система) */
    --mint: 75 37% 92%;
    --mint-light: 75 33% 96%;

    --peach: 25 80% 85%;
    --peach-dark: 25 60% 70%;
    --lavender: 270 50% 88%;
    --lavender-dark: 270 40% 75%;
    --cream: 40 40% 96%;
    --soft-pink: 350 60% 90%;
    --soft-blue: 200 60% 88%;

    /* Gradients — оливковые оттенки */
    --gradient-primary: linear-gradient(135deg, #6E7F3B 0%, #8A9B4B 100%);
    --gradient-peach: linear-gradient(135deg, hsl(25, 80%, 85%) 0%, hsl(350, 60%, 90%) 100%);
    --gradient-lavender: linear-gradient(135deg, hsl(270, 50%, 88%) 0%, hsl(200, 60%, 88%) 100%);
    --gradient-hero: linear-gradient(180deg, #FAFAF7 0%, #F3F6EC 100%);

    /* Shadows — мягкие, без мятных оттенков */
    --shadow-soft: 0 4px 20px -4px rgba(110, 127, 59, 0.12);
    --shadow-card: 0 8px 30px -8px rgba(47, 47, 47, 0.08);
    --shadow-button: 0 4px 14px -4px rgba(110, 127, 59, 0.25);

    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    --background: 240 10% 12%;
    --foreground: 30 20% 95%;

    --card: 240 10% 15%;
    --card-foreground: 30 20% 95%;

    --popover: 240 10% 15%;
    --popover-foreground: 30 20% 95%;

    --primary: 75 37% 45%;
    --primary-foreground: 0 0% 100%;

    --secondary: 25 50% 25%;
    --secondary-foreground: 25 80% 90%;

    --accent: 270 30% 30%;
    --accent-foreground: 270 50% 90%;

    --muted: 240 10% 20%;
    --muted-foreground: 240 5% 60%;

    --destructive: 0 60% 45%;
    --destructive-foreground: 0 0% 100%;

    --border: 240 10% 20%;
    --input: 240 10% 20%;
    --ring: 160 45% 55%;

    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  html {
    font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    scrollbar-gutter: stable;
  }

  body {
    @apply bg-background text-foreground antialiased leading-relaxed;
    font-feature-settings: "rlig" 1, "calt" 1;
    min-height: 100dvh;
    min-height: var(--app-height);
  }
}

@layer utilities {
  .gradient-primary {
    background: var(--gradient-primary);
  }

  .gradient-peach {
    background: var(--gradient-peach);
  }

  .gradient-lavender {
    background: var(--gradient-lavender);
  }

  .gradient-hero {
    background: var(--gradient-hero);
  }

  .shadow-soft {
    box-shadow: var(--shadow-soft);
  }

  .shadow-card {
    box-shadow: var(--shadow-card);
  }

  .shadow-button {
    box-shadow: var(--shadow-button);
  }

  .text-balance {
    text-wrap: balance;
  }

  .safe-bottom {
    padding-bottom: env(safe-area-inset-bottom, 1rem);
  }

  /** Нижняя навигация: внутренний padding под home indicator. main-above-nav уже учитывает (navHeight + safe-area). */
  .safe-bottom-nav {
    padding-bottom: max(12px, env(safe-area-inset-bottom, 12px));
  }

  .safe-top {
    padding-top: env(safe-area-inset-top, 1rem);
  }

  /** Хедер: фиксированная высота = --layout-header-offset (один источник истины для main-below-header).
   * Внутри: padding-top = safe-area, остальное — контентная зона. */
  .layout-header {
    height: var(--layout-header-offset);
    min-height: var(--layout-header-offset);
    padding-top: env(safe-area-inset-top, 0px);
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
  }

  .layout-header-inner {
    flex: 1;
    min-height: var(--header-content-height);
    padding-block: var(--header-row-py);
    display: flex;
    align-items: center;
    box-sizing: border-box;
  }

  /** Отступ main под хедер (уменьшен на 12px для единообразия + чуть сверху чтобы не заползало). */
  .main-below-header {
    padding-top: calc(var(--layout-header-offset) - 12px + 0.25rem);
  }

  /** Убрать overscroll (резинку): контент не оттягивается вниз, белая полоса не показывается. */
  .main-scroll-contain,
  .overscroll-y-contain {
    overscroll-behavior-y: contain;
  }

  /** Запрет горизонтального overscroll/scroll-chaining (страница План: нет плавания по X при свайпе). */
  .overscroll-x-none {
    overscroll-behavior-x: none;
  }

  /** Страницы без хедера: safe-area + небольшой отступ, чтобы контент не заползал за край */
  .main-safe-top {
    padding-top: calc(env(safe-area-inset-top, 0px) + 0.5rem);
  }

  /** Отступ main над таббаром (один источник: navHeight + safe-area). Не дублировать pb-* на страницах. */
  .main-above-nav {
    padding-bottom: var(--layout-main-bottom);
  }

  /** Вкладка План: деликатный точечный паттерн (оливковый, opacity 0.03–0.05). */
  .plan-page-bg {
    background-color: var(--color-bg-main);
    background-image: radial-gradient(circle at center, rgba(110, 127, 59, 0.04) 1px, transparent 1px);
    background-size: 24px 24px;
  }

  /** Вкладка Чат: светлее Плана, ощущение AI-ассистента. */
  .chat-page-bg {
    background-color: #FCFCFA;
  }

  /** Типографика: H1 24px/700, Section/Header 18px/600, Body 15px/400–500, Subtext 13–14px/muted. Токены: text-typo-h1, text-typo-header, text-typo-body, text-typo-subtext. */

  /** AI thinking: 3 точки с staggered анимацией (~1.2s цикл). */
  .chat-thinking-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: hsl(var(--primary) / 0.6);
    animation: chat-thinking-bounce 1.2s ease-in-out infinite;
  }
  .chat-thinking-dot:nth-child(1) { animation-delay: 0s; }
  .chat-thinking-dot:nth-child(2) { animation-delay: 0.15s; }
  .chat-thinking-dot:nth-child(3) { animation-delay: 0.3s; }
}

@keyframes chat-thinking-bounce {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
  30% { transform: translateY(-4px); opacity: 1; }
}

/** Шторка подсказок: плавное открытие/закрытие без рывка (200–250ms, ease-out). */
@keyframes sheet-hints-in {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
@keyframes sheet-hints-out {
  from { transform: translateY(0); opacity: 1; }
  to { transform: translateY(20px); opacity: 0; }
}
@keyframes sheet-hints-overlay-in {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes sheet-hints-overlay-out {
  from { opacity: 1; }
  to { opacity: 0; }
}
.sheet-hints-content[data-state=open] {
  animation: sheet-hints-in 220ms cubic-bezier(0.22, 1, 0.36, 1) forwards;
}
.sheet-hints-content[data-state=closed] {
  animation: sheet-hints-out 180ms ease-in forwards;
}
.sheet-hints-overlay {
  background-color: rgba(0, 0, 0, 0.4);
}
.sheet-hints-overlay[data-state=open] {
  animation: sheet-hints-overlay-in 180ms ease-out forwards;
}
.sheet-hints-overlay[data-state=closed] {
  animation: sheet-hints-overlay-out 150ms ease-in forwards;
}

/** Тултип «Подсказки» у кнопки ?: появление 150–200ms. */
@keyframes chat-help-tooltip-in {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}
.chat-help-tooltip {
  animation: chat-help-tooltip-in 180ms ease-out forwards;
}

/** Мягкий акцент на кнопке "?" при пустом чате: 2 pulse, затем остановить. */
@keyframes chat-hint-pulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(110, 127, 59, 0.25); }
  50% { box-shadow: 0 0 0 6px rgba(110, 127, 59, 0.12); }
}
.chat-hint-btn-pulse {
  animation: chat-hint-pulse 1s ease-in-out 2 forwards;
}

/* Custom scrollbar: узкий и у правого края, меньше занимает места */
::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}

::-webkit-scrollbar-track {
  background: transparent;
  margin: 4px 0;
  border-radius: 2px;
}

::-webkit-scrollbar-thumb {
  background: hsl(var(--primary) / 0.4);
  border-radius: 2px;
  margin-right: 2px;
}

::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--primary) / 0.7);
}

/* Hide scrollbar but keep scroll (horizontal chips, carousels) */
.scrollbar-none {
  scrollbar-width: none;
}

.scrollbar-none::-webkit-scrollbar {
  display: none;
}

/* Help-чат / Consultation Mode: спокойный медицинский формат */
.consultationCard {
  background: #fff;
  padding: 16px;
  border-radius: 16px;
  line-height: 1.65;
  box-shadow: none;
}

.consultationCard-inner {
  padding: 0;
}

.consultationWarning {
  display: flex;
  gap: 8px;
  padding: 12px;
  border-radius: 12px;
  background: rgba(111, 126, 55, 0.08);
  margin-top: 12px;
}

.consultationDisclaimer {
  font-size: 12px;
  opacity: 0.6;
  margin-top: 12px;
  color: var(--muted-foreground);
}