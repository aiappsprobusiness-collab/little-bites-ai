/**
 * LLM-оптимизированные чипсы для Help bottom sheet (DeepSeek 3.2).
 * Ключи = topicKey из проекта (sosTopics). По 4 чипса на тему: { label, prompt }.
 * prompt задаёт структуру ответа: причины, что сделать, когда к врачу, уточняющие вопросы.
 */

export interface HelpChipItem {
  label: string;
  prompt: string;
}

/** topicKey проекта → массив из 4 чипсов */
export const HELP_TOPIC_CHIPS: Record<string, HelpChipItem[]> = {
  // food_refusal — нет аппетита / отказ от еды
  food_refusal: [
    {
      label: "Отказывается от еды несколько дней",
      prompt:
        "Ситуация: ребёнок отказывается от еды уже несколько дней. Составь ответ строго по структуре: 1) Возможные причины (2–3) 2) Что сделать сегодня (3–5 шагов) 3) Когда срочно к врачу (коротко) 4) 2–3 уточняющих вопроса. Спокойно, без запугивания.",
    },
    {
      label: "Резко перестал есть (раньше ел)",
      prompt:
        "Ситуация: раньше ребёнок ел нормально, а сейчас резко отказывается. Ответ по структуре: причины (2–3), что проверить дома (3–5), когда к врачу, 2–3 уточняющих вопроса. Коротко.",
    },
    {
      label: "Плачет во время кормления",
      prompt:
        "Ситуация: ребёнок плачет во время кормления. Ответ по структуре: причины (2–3), что сделать сейчас (3–5), когда срочно к врачу, 2–3 уточняющих вопроса. Без воды.",
    },
    {
      label: "Ест только пюре, кусочки выплёвывает",
      prompt:
        "Ситуация: ест только пюре, кусочки выплёвывает. Ответ: норма ли это в общих чертах, как мягко вводить текстуры (3–5), когда насторожиться, 2–3 вопроса. Спокойно.",
    },
  ],

  // allergy
  allergy: [
    {
      label: "Сыпь после нового продукта",
      prompt:
        "Ситуация: после нового продукта появилась сыпь. Ответ: аллергия vs раздражение (2–3 признака), что делать сейчас (3–5), когда срочно к врачу, 2–3 уточняющих вопроса. Без паники.",
    },
    {
      label: "Покраснение вокруг рта",
      prompt:
        "Ситуация: покраснение вокруг рта после еды. Ответ: причины (2–3), что делать и можно ли продолжать продукт, когда к врачу, 2–3 вопроса. Коротко.",
    },
    {
      label: "Зуд, чешется",
      prompt:
        "Ситуация: зуд/чешется после еды. Ответ: причины (2–3), что сделать сегодня (3–5), когда срочно к врачу, 2–3 вопроса. Практично.",
    },
    {
      label: "Аллергия или раздражение?",
      prompt:
        "Ситуация: не понимаю аллергия или раздражение. Дай чек-лист: признаки аллергии (3), признаки раздражения (3), что делать 24 часа (3–5), когда к врачу.",
    },
  ],

  // constipation_diarrhea — стул
  constipation_diarrhea: [
    {
      label: "Жидкий стул, часто",
      prompt:
        "Ситуация: стул жидкий и частый. Ответ: причины (2–3), что делать дома (3–5), признаки обезвоживания и когда срочно к врачу, 2–3 вопроса. Чётко.",
    },
    {
      label: "Запор несколько дней",
      prompt:
        "Ситуация: запор несколько дней. Ответ: причины (2–3), мягкие меры (3–5), когда к врачу, 2–3 вопроса. Безопасно.",
    },
    {
      label: "Слизь в стуле",
      prompt:
        "Ситуация: слизь в стуле. Ответ: причины (2–3), что наблюдать/делать сегодня, когда к врачу, 2–3 вопроса.",
    },
    {
      label: "Изменился цвет",
      prompt:
        "Ситуация: изменился цвет стула. Ответ: что часто бывает от еды (кратко), что требует внимания, когда к врачу (опасные варианты), 2–3 вопроса.",
    },
  ],

  // spitting_up — срыгивания
  spitting_up: [
    {
      label: "После каждого кормления",
      prompt:
        "Ситуация: срыгивает после каждого кормления. Ответ: когда норма (2–3 ориентира), что попробовать (3–5), когда к врачу, 2–3 вопроса. Спокойно.",
    },
    {
      label: "Большой объём",
      prompt:
        "Ситуация: срыгивает большим объёмом. Ответ: причины (2–3), что сделать сегодня (3–5), когда срочно к врачу, 2–3 вопроса.",
    },
    {
      label: "Через 1–2 часа",
      prompt:
        "Ситуация: срыгивает через 1–2 часа. Ответ: причины (2–3), что попробовать (3–5), когда к врачу, 2–3 вопроса.",
    },
    {
      label: "Беспокоится после",
      prompt:
        "Ситуация: беспокоится после срыгивания. Ответ: причины (2–3), что сделать сегодня, когда к врачу, 2–3 вопроса.",
    },
  ],

  // routine — график кормления
  routine: [
    {
      label: "Сколько раз в день?",
      prompt:
        "Вопрос: сколько раз в день обычно кормят ребёнка в этом возрасте? Ответ: общая рамка, как понять что режим подходит (3 признака), типичные ошибки, 2–3 вопроса.",
    },
    {
      label: "Ночные кормления?",
      prompt:
        "Вопрос: нужны ли ночные кормления сейчас? Ответ: от чего зависит (2–3 фактора), как мягко менять (3–5), когда лучше не убирать, 2–3 вопроса.",
    },
    {
      label: "Сбился режим",
      prompt:
        "Ситуация: сбился режим питания. Ответ: причины (2–3), план на 3 дня (шаги), на что смотреть, 2–3 вопроса.",
    },
    {
      label: "Просит есть часто",
      prompt:
        "Ситуация: просит есть очень часто. Ответ: причины (2–3), что сделать сегодня (3–5), когда насторожиться, 2–3 вопроса.",
    },
  ],

  // food_diary — дневник / баланс питания
  food_diary: [
    {
      label: "Рацион разнообразный?",
      prompt:
        "Вопрос: достаточно ли разнообразен рацион? Ответ: критерии (3), как улучшить за неделю (3–5), ошибки, 2–3 вопроса.",
    },
    {
      label: "Хватает белка/железа?",
      prompt:
        "Вопрос: как понять хватает ли белка и железа? Ответ: косвенные признаки (без диагнозов), что добавить в питание (3–5), когда обсудить с врачом, 2–3 вопроса.",
    },
    {
      label: "Ест одно и то же",
      prompt:
        "Ситуация: ест одно и то же. Ответ: причины (2–3), как расширять без давления (3–5), когда это проблема, 2–3 вопроса.",
    },
    {
      label: "Нужны витамины?",
      prompt:
        "Вопрос: нужны ли витамины/добавки? Ответ: когда обычно не нужны (кратко), когда обсудить с врачом, что сделать через питание (3–5), 2–3 вопроса. Без категоричности.",
    },
  ],

  // urgent_help — срочное
  urgent_help: [
    {
      label: "Температура + отказ от еды",
      prompt:
        "Ситуация: высокая температура и отказ от еды. Ответ: что сделать сейчас (3–5), что наблюдать, когда срочно к врачу, 2–3 вопроса. Чётко, без паники.",
    },
    {
      label: "Рвота и понос",
      prompt:
        "Ситуация: рвота и понос одновременно. Ответ: первые действия, признаки обезвоживания, когда срочно к врачу, 2–3 вопроса. Без паники.",
    },
    {
      label: "Резко пропал аппетит",
      prompt:
        "Ситуация: резко пропал аппетит. Ответ: причины (2–3), что проверить сегодня, красные флаги, 2–3 вопроса.",
    },
    {
      label: "Когда точно к врачу?",
      prompt:
        "Вопрос: какие симптомы требуют срочной консультации врача? Дай короткий список красных флагов и 2–3 уточняющих вопроса.",
    },
  ],
};

/** Ключ темы в проекте может отличаться от ключа в чипсах; маппинг при необходимости. */
export const TOPIC_KEY_TO_CHIPS_KEY: Record<string, string> = {
  food_refusal: "food_refusal",
  allergy: "allergy",
  constipation_diarrhea: "constipation_diarrhea",
  spitting_up: "spitting_up",
  routine: "routine",
  food_diary: "food_diary",
  urgent_help: "urgent_help",
  new_food: "new_food",
};

/** Чипсы для темы по topicKey (с учётом маппинга). */
export function getChipsForTopic(topicKey: string): HelpChipItem[] {
  const chipsKey = TOPIC_KEY_TO_CHIPS_KEY[topicKey] ?? topicKey;
  return HELP_TOPIC_CHIPS[chipsKey] ?? [];
}
