# Решение проблем с GigaChat

## Ошибка "Не удалось создать рецепт"

### Возможные причины и решения:

#### 1. Проблема с API ключом

**Симптомы:**
- Ошибка "Ошибка авторизации GigaChat"
- Ошибка "Неверный API ключ"
- Ошибка 401 или 403

**Решение:**
1. Проверьте файл `.env` в корне проекта
2. Убедитесь, что ключ в Base64 формате
3. Проверьте, что нет лишних пробелов
4. Перезапустите dev сервер после изменения `.env`

#### 2. Проблема с подключением

**Симптомы:**
- Ошибка "Проблема с подключением"
- Ошибка CORS
- Таймаут запроса

**Решение:**
- Проверьте интернет-соединение
- GigaChat API может блокировать запросы из браузера (CORS)
- Для продакшена используйте backend proxy

#### 3. Проблема с форматом ответа

**Симптомы:**
- Рецепт не создается, но ошибки нет
- В консоли: "Failed to parse recipe JSON"

**Решение:**
- Это нормально - используется fallback рецепт
- Проверьте консоль браузера (F12) для деталей

## Как проверить, что GigaChat настроен

1. Откройте консоль браузера (F12)
2. Перейдите на вкладку Console
3. Введите:
   ```javascript
   console.log(import.meta.env.VITE_GIGACHAT_CLIENT_SECRET_KEY)
   ```
4. Если видите `undefined` - ключ не настроен
5. Если видите строку - ключ настроен

## Проверка API ключа

### В PowerShell:
```powershell
# Проверьте, что ключ в Base64
$key = "ваш_ключ"
[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($key))
```

Если ошибка - ключ не в Base64 формате.

## Детальная диагностика

### Шаг 1: Проверьте консоль браузера

Откройте DevTools (F12) → Console и найдите ошибки:
- Красные ошибки покажут детали проблемы
- Ищите сообщения с "GigaChat" или "token"

### Шаг 2: Проверьте Network

1. Откройте DevTools (F12) → Network
2. Попробуйте создать рецепт
3. Найдите запросы к `gigachat.devices.sberbank.ru`
4. Проверьте статус ответа:
   - 200 - OK
   - 401 - Неверный ключ
   - 403 - Доступ запрещен
   - 500 - Ошибка сервера

### Шаг 3: Проверьте .env файл

Файл должен содержать:
```env
VITE_GIGACHAT_CLIENT_SECRET_KEY=ваш_base64_ключ
VITE_GIGACHAT_IS_PERSONAL=true
```

**Важно:**
- Нет пробелов вокруг `=`
- Нет кавычек вокруг значений
- Перезапустите сервер после изменения

## Частые ошибки

### "GigaChat не настроен"
- Файл `.env` не создан или не в корне проекта
- Переменная `VITE_GIGACHAT_CLIENT_SECRET_KEY` не установлена
- Перезапустите dev сервер

### "Ошибка получения токена: 401"
- Неверный API ключ
- Ключ не в Base64 формате
- Проверьте ключ на developers.sber.ru/gigachat

### "CORS error"
- GigaChat API блокирует запросы из браузера
- Используйте backend proxy для продакшена
- Для разработки можно использовать расширение для обхода CORS (не рекомендуется)

## Получение нового ключа

1. Перейдите на https://developers.sber.ru/gigachat
2. Войдите в аккаунт
3. Создайте новое приложение
4. Получите Client Secret Key
5. Конвертируйте в Base64:
   ```powershell
   [Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes('ваш_ключ'))
   ```
6. Обновите `.env` файл
7. Перезапустите сервер
